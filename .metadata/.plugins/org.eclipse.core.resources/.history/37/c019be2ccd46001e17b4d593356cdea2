package kr.or.ddit.servlet01;

import java.io.File;
import java.io.FilenameFilter;
import java.io.IOException;
import java.io.PrintWriter;
import java.text.MessageFormat;

import javax.servlet.ServletConfig;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("/imageForm.do")
public class ImageFormServlet extends HttpServlet{
	
	File imageFolder;
	private ServletContext application;
	
	@Override
	public void init(ServletConfig config) throws ServletException {
		super.init(config);
		
		application = getServletContext();
		
		String value = application.getInitParameter("imageFolder");
		
		imageFolder = new File(value);
	}
	
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		resp.setContentType("text/html; charset=utf-8");
		
		
//		File imageFolder = new File("D:/01.medias/images");
		
		String[] imageFileNames = imageFolder.list(new FilenameFilter(dir, name) -> {
				return !name.endsWith("hwp");
			});
		// 이미지가 아닌 파일을 제거하고 옵션 구성 Filter 활용
		// 람다 문법 활용
		StringBuilder options = new StringBuilder();
		
		for(String imageName : imageFileNames) {
			options.append(
					MessageFormat.format("<option value='{0}'>{1}</option>",imageName,imageName));
		}
		
		
        StringBuilder content = new StringBuilder();
        content.append("<html>");
        content.append("<body>");
        content.append(String.format("<form onsubmit='submitHandler(event);' action='%s/image.do'>", req.getContextPath()));
        content.append("<select name='image' onchange='this.form.requestSubmit();' >");
        content.append(options);
        content.append("</select>");
        content.append("<input type='submit' value='전송'>");
        content.append("</form>");
        content.append("<script>                           ");
        content.append("   function submitHandler(event) {");
        content.append("      event.preventDefault();    ");
//        content.append("<img >  ");
        content.append("   }                              ");
        content.append("</script>                          ");
        
        
        
        content.append("</body>");
        content.append("</html>");

		
		
		/*
		StringBuilder content = new StringBuilder();
		content.append("<html>");
        content.append("<body>");
        content.append(String.format("<form onsubmit='submitHandler(event);' action='%s/image.do'>", req.getContextPath()));
        content.append("<select name='image' id='image' onchange='showImage();' >");
        content.append(options);
        content.append("</select>");
        content.append("<input type='submit' value='전송'>");
        content.append("</form>");
        content.append("<div id='imgDiv'>kkk</div>");
        content.append("<script>");
        content.append("   function submitHandler(event) {");
        content.append("      event.preventDefault();    ");
        content.append("   }");
        content.append("   function showImage() {");
//        String image = "\"<img src='./image.do?image=cat1.jpg'/>\"";      
//        content.append("image=\"<img src='./image.do?image=cat1.jpg'/>\"");    
//        content.append("imgDc = document.getElementById('image')");
//        content.append("imgName = imgDc.option[imgDc.selectedIndex].value");
        content.append("img = document.createElement('img')");
        content.append("img.setAttribute('src','image.do?image=./image.do?image=cat1.jpg'");
        content.append("document.getElementById('imgDiv').innerHTML = img");
//        content.append("document.getElementById('imgDiv').innerHTML = "+"`<img src='./image.do?image=${this.value}'/>`");
        content.append("   } ");
        content.append("</script>");
        content.append("</body>");
        content.append("</html>");
		*/
		
		PrintWriter out = resp.getWriter();
		out.println(content);
		
		out.close();
		

	}
}
