package kr.or.ddit.servlet04;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

@WebServlet("")
public class CalendarControllerServlet extends HttpServlet{
	@Override
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
//		super.service(req, resp);	//request의 메서드를 판단하고 그에 맞는 do계열의 콜백메서드를 사용
		//request의메서드와 상관없이 캘린더 처리
		
		String yearParam = request.getParameter("year");
		String monthParam = request.getParameter("month");
		String localeParam = request.getParameter("locale");
		
		Locale locale = Optional.ofNullable(localeParam)
			.map(lp->Locale.forLanguageTag(lp))
			.orElse(request.getLocale());

//	 	Locale locale = request.getLocale();	//reqeust header(Accept-Language)
		
		int year = Optional.ofNullable(yearParam)
						.filter((yp)->yp.matches("\\d{4}"))
						.map((yp)->Integer.parseInt(yp))
						.orElse(Year.now().getValue());

		
		YearMonth targetMonth = Optional.ofNullable(monthParam)
									.filter((mp)->mp.matches("[1-9]|1[0-2]"))
									.map((mp)->Integer.parseInt(mp))
									.map((m)->YearMonth.of(year, m))
									.orElse(YearMonth.now());
		YearMonth beforeMonth = targetMonth.minusMonths(1);
		YearMonth nextMonth = targetMonth.plusMonths(1);
		
		
	}
}
